name: Build and Deploy Next.js App to GitHub Pages

on:
   push:
      branches:
         - main

jobs:
   build:
      runs-on: ubuntu-latest

      steps:
         - name: Checkout repository
           uses: actions/checkout@v3

         - name: Setup Node.js environment
           uses: actions/setup-node@v4
           with:
              node-version: "20"

         - name: Install dependencies
           run: npm install

         - name: Build Next.js app
           run: npm run build

         - name: Upload production build artifact
           uses: actions/upload-artifact@v3
           with:
              name: build
              path: out

   deploy:
      runs-on: ubuntu-latest
      needs: build
      steps:
         - name: Checkout repository
           uses: actions/checkout@v3

         - name: Download production build artifact
           uses: actions/download-artifact@v3
           with:
              name: build

         - name: Deploy to GitHub Pages
           uses: JamesIves/github-pages-deploy-action@v4
           with:
              branch: gh-pages
              folder: out
